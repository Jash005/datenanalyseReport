---
title: "Report - Traffic Accidents"
authors:
    - Mathangi Pirasanthan
    - Miriam Mack
    - Jasmin Hauschild
date: today
format: html
---

#### Datensatz:
https://www.kaggle.com/datasets/oktayrdeki/traffic-accidents

### Imports
```{r}
library(tidyverse)
library(skimr)
library(lubridate)

```

## 1. Definition/Formulierung der Fragestellung

::: {.callout-note icon="false"}
## Aufgabenstellung (10 Pkt.)

Definieren Sie eine interessierende bzw. interessante Fragestellung im Zusammenhang mit dem Datensatz:

-   Was interessiert Sie an dem Datensatz?
-   Welche spezifische Fragestellung würden Sie gern mit Hilfe des Datensatzes beantworten?
-   Was erwarten Sie, angesichts Ihrer Fragestellung, bezüglich des Datensatzes?
:::

Ausgangspunkt unserer Analyse ist ein umfangreicher Datensatz zu Verkehrsunfällen. Dieser enthält zeitliche Informationen, Angaben zu den Umgebungsbedingungen wie Wetter und Lichtverhältnisse sowie Merkmale zur Art des Unfalls und zur Schwere der Verletzungen. Besonders interessant ist dabei die Kombination aus zeitlichen, infrastrukturellen und situativen Variablen. Denn Verkehrsunfälle entstehen in der Regel nicht durch einen einzelnen Faktor, sondern durch das Zusammenspiel mehrerer Rahmenbedingungen. Wir untersuchen, ob sich aus diesen Daten systematische Muster erkennen lassen, die über reine Unfallhäufigkeiten hinausgehen und Hinweise auf typische Risikosituationen geben.

Konkret lautet unsere Fragestellung: Welche äußeren Bedingungen und Unfalleigenschaften stehen in einem erkennbaren Zusammenhang mit der Schwere von Verkehrsunfällen? Im Fokus steht, ob bestimmte Kombinationen aus Wetterlage, Lichtverhältnissen, Unfalltyp, Wochentag und Verkehrssituation häufiger mit Verletzungen oder schweren Unfällen verbunden sind als andere. Das Ziel der Analyse ist nicht die Vorhersage einzelner Unfälle, sondern ein besseres Verständnis dafür, unter welchen Bedingungen Unfälle eher glimpflich verlaufen und wann das Risiko für Verletzungen deutlich ansteigt.

Auf Grundlage allgemeiner Annahmen zur Verkehrssicherheit erwarten wir, dass ungünstige Sichtverhältnisse wie Dunkelheit oder Regen sowie komplexe Verkehrssituationen wie Kreuzungen oder Abbiegevorgänge mit einer höheren Unfall und Verletzungsschwere einhergehen. Zudem vermuten wir, dass in den Wintermonaten insgesamt mehr Unfälle auftreten, da Faktoren wie Schnee, Eis und eine geringere Tageslichtdauer die Fahrsituation zusätzlich erschweren. Gleichzeitig gehen wir davon aus, dass ein großer Anteil der Unfälle unter scheinbar günstigen Bedingungen wie Tageslicht und trockener Fahrbahn passiert. Diese Annahme begründet sich darin, dass unter solchen Bedingungen das Verkehrsaufkommen in der Regel deutlich höher ist, etwa im Berufsverkehr oder im alltäglichen Individualverkehr, wodurch es trotz guter Sicht und Fahrbahnverhältnisse häufiger zu Unfällen kommt. Wir erwarten jedoch, dass diese Unfälle überwiegend weniger schwer verlaufen, da bessere Sicht, höhere Reaktionsmöglichkeiten und insgesamt kontrollierbarere Fahrsituationen das Risiko schwerer Verletzungen reduzieren. Die Analyse soll zeigen, ob sich diese Erwartungen im Datensatz bestätigen lassen oder ob einzelne Faktoren überschätzt werden und andere, bislang weniger beachtete Einflüsse eine größere Rolle spielen.


## 2. Laden der Daten

::: {.callout-note icon="false"}
## Aufgabenstellung (10 Pkt.)

Laden Sie die Daten in die R-Sitzung und verschaffen Sie sich einen ersten Überblick \* Welche Typen sind enthalten? \* Ist sichergestellt, dass alle Daten den richtigen Typ haben? \* Haben die Daten irgendwelche "Seltsamkeiten" mit denen Sie umgehen müssen, wie z.B. anders codierte `NA`'s, mehrere Tabellen, ... etc. \* Je nach Datensatz können Sie die Daten auch in eine Datenbank laden und dann auf diese in R zugreifen.

Beschreiben Sie, was Sie tun müssen, bevor Sie die Daten im nächsten Abschnitt aufbereiten und bearbeiten können!
:::



```{r}
dataset <- read.table(
  file ="dataset_traffic_accidents.csv", sep = ",", header=T, stringsAsFactors = F
)

#lapply(dataset, unique)
#str(dataset)



# optional
#head(dataset, 3)
#dim(dataset)

#View(dataset)


#colSums(is.na(dataset))
#sapply(dataset, class)
#table(dataset$weather_condition)

```

Nach dem Import des Datensatzes haben wir mittels glimpse() eine erste Bestandsaufnahme durchgeführt. Die Daten liegen als Mischung aus numerischen (int, dbl) und textbasierten (chr) Variablen vor. Dabei zeigten sich folgende Auffälligkeiten, die eine direkte Verwendung für die Analyse verhindern:

Fehlerhafte Datentypen: Die Zeitstempel (crash_date) werden als Zeichenkette interpretiert. Für eine zeitliche Analyse (Wochentag, Tageszeit) ist eine Konvertierung in ein date/time-Objekt und eine Extraktion der Komponenten notwendig. auch wenn spalten wie crash_hour, crash_day_of_week und crash_month hier vorgegbene sind extrahieren wir es sslbst aus dem crash_date, aus dem grund da wir dann unsere formatierung  nehmen können. in den usa entspricht z.b. 1 dem sonntag und bei unserer interpretation es ist eine 1 für montag intuitiver und bdearf nuícht unbeding eigene rklärungen. auch ist es für analysen sinnvoller das als date formatiert zu haben und nicht als numerischen wert.. Ebenso liegen logisch geordnete Daten wie die Schadenshöhe (damage) und nominale Kategorien (z. B. weather_condition) noch als ungeordnete Strings vor und müssen in Faktoren (factor) umgewandelt werden.

Versteckte fehlende Werte: Die Spalten enthalten diverse Platzhalter für fehlende Informationen, die nicht als technisches NA kodiert sind. Werte wie "UNKNOWN" (z. B. bei road_defect) oder "UNABLE TO DETERMINE" (bei prim_contributory_cause) treten häufig auf.

Daten-Inkositenz: Spalten wie most_severe_injury nutzen Textbeschreibungen ("NO INDICATION..."), wo numerische Skalen oder boolesche Werte effizienter wären.

wir extrahieren die Uhrzeit und den wochentag aud dem Crash_date, weil in der spalte crash_hour einem bestimmten schema folgt und bevor das überstezt und transormiert wird ist es leichter es aus dem crash_date heruaszuextrahieren (das muss eh beaneberitet werden). somit würde die spalten crash_hour, crash_day_of_week und crash_month wegfallen

über lapply(dataset, unique) prüfen wir alle Werte pro Spalte und cleanen damit die werte um analysen nicht zu verfäschen. z.b. wenn es eine großzahl von fehelnden Werten gibt diese werden einheitlich zu NA konvertiert. Bei Attributen wie prim_contributory_cause wird es sinn machen hier ähnliche Werte zusammenzuführen, weil 40 verschiedene Werte werden schwer darstellbar. Kleine mögliche Gruppierungen werden bei bedarf in der jeweiligen Chart gemacht.


## 3. Bearbeiten/Transformieren der Daten

::: {.callout-note icon="false"}
## Aufgabenstellung (15 Pkt.)

In diesem Abschnitt sollten Sie alle notwendigen Transformationen/Bereiningungen/... etc. der Daten vornehmen (Data Muning, Data Cleansing), wie z.B.: \* Umcodierung von Daten, z.B. numerisch in kategorial \* Subsetting der Daten \* Joining von Datentabellen - falls nötig. Welcher Join ist notwendig? Warum? \* ...

Verschaffen Sie sich eine Übersicht der transformierten Daten. Sie können hierzu Hilfsmittel wie `glimpse()`, `skim()` und `head()` benutzen, um Ihre Erläuterungen zu veranschaulichen.

Sind die sich ergebenden Daten so, wie Sie es erwartet haben? Warum oder warum nicht?
:::

```{r}
#glimpse(dataset)
#skim(dataset)
#head(dataset)
```

### Duplikate entfernen
Mithilfe der Methode distinct() aus dem tidyverse-Package können Duplikate in den Daten identifiziert und entfernt werden. Dieser Schritt ist notwendig, um zu verhindern, dass Analysen durch mehrfach vorkommende identische Datensätze verfälscht werden.
```{r}
dataset.clean <- dataset %>%
  distinct()
```

### Feature Engineering
Die Spalte crash_date wird in Wochentag, Stunde, Monat und Jahr aufgeteilt. Die vorhandenen Spalten crash_hour, crash_day_of_week und crash_month werden entfernt, um eigene Interpretationen, z. B. des Wochentags, zu ermöglichen und dadurch mehr Flexibilität zu schaffen. Nach der Extraktion werden zudem neben den ursprünglichen Spalten auch crash_date entfernt, das dient der Übersichtlichkeit.

** in ordniale Werte konvertiert
```{r} 
dataset.clean <- dataset.clean %>%
  mutate(
    crash_timestamp = mdy_hms(crash_date),

    crash_hour_num = hour(crash_timestamp),
    crash_wday_label = wday(crash_timestamp, label = TRUE, abbr = FALSE, week_start = 1),
    crash_month_label = month(crash_timestamp, label = TRUE, abbr = FALSE),
    crash_year_num = year(crash_timestamp),

    season = case_when(
      crash_month_label %in% c("Dezember", "Januar", "Februar") ~ "Winter",
      crash_month_label %in% c("März", "April", "Mai") ~ "Spring",
      crash_month_label %in% c("Juni", "Juli", "August") ~ "Summer",
      crash_month_label %in% c("September", "Oktober", "November") ~ "Autumn"
    )
  )

```

### Selektieren der relevanten Attribute

| Kategorie | Attribut | Beschreibung |
|-----------|----------|--------------|
| **Zeitliche Faktoren** | `crash_hour` | Stunde des Unfalls (tageszeitliche Muster) |
| | `crash_day_of_week` | Wochentag des Unfalls (Werktag vs. Wochenende) |
| | `crash_month` | Monat des Unfalls (saisonale Muster) |
| **Straßen- und Infrastruktur** | `trafficway_type` | Art der Straße (z.B. Autobahn, Landstraße) |
| | `alignment` | Straßenverlauf (gerade, Kurve) |
| | `roadway_surface_cond` | Fahrbahnzustand (trocken, nass, Eis) |
| | `road_defect` | Vorhandene Straßenschäden |
| | `intersection_related_i` | Kreuzungsbezug (ja/nein) |
| **Umgebungs- und Sichtbedingungen** | `weather_condition` | Wetterlage zum Unfallzeitpunkt |
| | `lighting_condition` | Lichtverhältnisse (Tageslicht, Dunkelheit) |
| | `traffic_control_device` | Art der Verkehrsregelung (Ampel, Schild) |
| **Unfallcharakteristika** | `first_crash_type` | Initiale Aufprallart (frontal, Heck, etc.) |
| | `crash_type` | Gesamttyp des Unfalls |
| | `prim_contributory_cause` | Hauptursache des Unfalls |

: Übersicht der verwendeten Attribute und deren Relevanz für die Analyse {#tbl-attributes}
```{r}
dataset.clean <- dataset.clean %>%
  select(
    # Zeitliche Faktoren 
    crash_year_num, crash_hour_num, crash_wday_label, crash_month_label,
    # Straßen- und Infrastruktur
    trafficway_type, alignment, roadway_surface_cond, road_defect, intersection_related_i,
    # Umgebungs- und Sichtbedingungen
    weather_condition, lighting_condition, traffic_control_device,
    # Unfallcharakteristika
    first_crash_type, crash_type, prim_contributory_cause
  )
```

### Datenwerte bereinigen
Werte, die nicht bekannt sind, werden häufig als „Unknown“, „Unable to determine“ oder ähnliche Einträge erfasst. Treten solche Werte in einer Spalte häufig auf, kann dies die Analyse verzerren, da sie den Großteil der Daten ausmachen und den Fokus auf relevante Informationen verschieben. Deshalb werden diese Werte einheitlich auf Na gesetzt, sodass sie in der Analyse gruppiert betrachtet und bei Bedarf ausgeschlossen werden können.
```{r}
dataset.clean <- dataset.clean %>%
  mutate(
    prim_contributory_cause = na_if(prim_contributory_cause, "UNABLE TO DETERMINE"),
    prim_contributory_cause = na_if(prim_contributory_cause, "NOT APPLICABLE"),
    weather_condition = na_if(weather_condition, "UNKNOWN"),
    road_defect = na_if(road_defect, "UNKNOWN"),
    lighting_condition = na_if(lighting_condition, "UNKNOWN"),
    roadway_surface_cond = na_if(roadway_surface_cond, "UNKNOWN"),
    traffic_control_device = na_if(traffic_control_device, "UNKNOWN")
  )

```


### Gruppieren von Werten

```{r}
dataset.clean <- dataset.clean %>%
  mutate(
    # Wir erstellen eine vereinfachte Kategorie
    trafficway_type_simple = case_when(
      # 1. Alles was "Divided" ist (egal ob mit Mauer oder ohne)
      str_detect(trafficway_type, "DIVIDED") ~ "Divided Road",
      
      # 2. Einbahnstraßen
      trafficway_type == "ONE-WAY" ~ "One-Way",
      
      # 3. Normale Straßen (Nicht getrennt)
      trafficway_type %in% c("NOT DIVIDED", "TWO-WAY", "CENTER TURN LANE") ~ "Two-Way (Not Divided)",
      
      # 4. Kreuzungen/ (alle Typen)
      trafficway_type %in% c("FOUR WAY", 
                             "T-INTERSECTION", 
                             "Y-INTERSECTION", 
                             "L-INTERSECTION", 
                             "FIVE POINT, OR MORE", 
                             "ROUNDABOUT", 
                             "UNKNOWN INTERSECTION TYPE") ~ "Intersection",

      # 5. Spezialfälle (alles andere z.B. Parking_lot, ramp, driveway, alley, unkonw/not reported)
      TRUE ~ "Other"
    )
  ) %>%
  select(-trafficway_type) %>%

  mutate(
    cause_group = case_when(
      # --- 1. WETTER ---
      prim_contributory_cause == "WEATHER" ~ "Weather",
      
      # --- 2. Andere Externe Faktoren (Tiere, Straße, Sicht) ---
      prim_contributory_cause %in% c("ANIMAL", 
                                     "ROAD ENGINEERING/SURFACE/MARKING DEFECTS", 
                                     "VISION OBSCURED (SIGNS, TREE LIMBS, BUILDINGS, ETC.)",
                                     "EVASIVE ACTION DUE TO ANIMAL, OBJECT, NONMOTORIST") ~ "External Factors (Non-Weather)",
      
      # --- 3. Ablenkung ---
      str_detect(prim_contributory_cause, "DISTRACTION|TEXTING|CELL PHONE") ~ "Distracted Driving",
      
      # --- 4. Substanzen (Alkohol/Drogen) ---
      str_detect(prim_contributory_cause, "ALCOHOL|DRINKING|DRUGS|HAD BEEN DRINKING") ~ "Impaired (Alcohol/Drugs)",
      
      # --- 5. Raser / Aggressiv ---
      str_detect(prim_contributory_cause, "SPEED|RECKLESS|AGGRESSIVE") ~ "Speeding/Aggressive",
      
      # --- 6. Regelverstöße (Ampel/Schilder) ---
      str_detect(prim_contributory_cause, "YIELD|SIGNAL|STOP SIGN|RED LIGHT|DISREGARDING") ~ "Disregarded Traffic Control",
      
      # --- 7. Klassische Fahrfehler ---
      prim_contributory_cause %in% c("FOLLOWING TOO CLOSELY", "IMPROPER TURNING/NO SIGNAL", 
                                     "IMPROPER BACKING", "IMPROPER LANE USAGE", 
                                     "IMPROPER OVERTAKING/PASSING", "FAILING TO YIELD RIGHT-OF-WAY") ~ "Driver Error",
      
      # --- 8. NA bleibt NA ---
      is.na(prim_contributory_cause) ~ NA_character_,
      
      # --- 9. Rest ---
      TRUE ~ "Other Cause"
    )
  ) %>%
  select(-prim_contributory_cause)
```

### Y/N Spalten zu TRUE und FALSE transformieren
In der Spalte intersection_related_i sind boolsche Werte enthalten, aber als Y und N in charactes formatiert. hier sollten diese in TRUE und FALSE überführt werden.
```{r}
dataset.clean <- dataset.clean %>%
  mutate(
    intersection_related_i = if_else(intersection_related_i == "Y", TRUE, FALSE)
  )
```






## 4. Geeignete Visualisierung und Aggregation der Daten

::: {.callout-note icon="false"}
## Aufgabenstellung (15 Pkt.)

Fassen Sie die Daten in einer geeigenten Form zur Beantwortung Ihrer formulierten Fragestellung zusammen. Ziehen Sie auch geeignete Visualisierungen der transformierten und/oder aggregierten Daten heran, um Ihre Aussagen entsprechend zu untermauern oder zu veranschaulichen.

Hier könne Sie auch geeignete statistische Verfahren bzw. Modellierungen nutzen, falls diese Ihnen bezüglich Ihrer Fragestellung weiterhelfen.
:::

## 5. Zusammenfassung und Schlussfolgerung

::: {.callout-note icon="false"}
## Aufgabenstellung (10 Pkt.)

Fassen Sie hier Ihre Fragestellung und Ihre Erkenntnisse aus Ihrer Analyse zusammen.

Sind Ihre Erkenntnisse das, was Sie erwartet haben? Warum oder warum nicht?
:::

## Quellenverzeichnis
* Datensatz: Oktay Ördekçi, „Kaggle Datensatz - Traffic Accidents“. Zugegriffen: 23. Oktober 2025. [Online]. Verfügbar unter: https://www.kaggle.com/datasets/oktayrdeki/traffic-accidents
* [1] weitere Quelle...
